<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compound Visualizer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Define custom theme color from SVG -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand': '#FFA500', // The SVG color
                    }
                }
            }
        }
    </script>
    <!-- Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Courier New', Courier, monospace;
        }
        .font-heading {
            font-family: 'Times New Roman', Times, serif;
        }
        /* Custom styles for number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        /* Custom slider styles */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #333333; /* Neutral gray */
            border-radius: 5px;
            outline: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #FFA500; /* Accent orange */
            border: 2px solid #000000; /* black */
            border-radius: 50%;
            cursor: pointer;
        }
        input[type=range]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #FFA500;
            border: 2px solid #000000; /* black */
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-black antialiased text-brand">

    <div class="container mx-auto max-w-7xl p-4 sm:p-8">
        <div class="bg-black rounded-2xl shadow-xl overflow-hidden border border-neutral-800">
            
            <header class="bg-black p-8">
                <!-- SVG Logo -->
                <svg id="uuid-d42eca4d-b207-4968-85d8-fef4dbf0358c" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" class="w-24 h-auto mx-auto mb-4" viewBox="0 0 331.766 431.38">
                    <defs>
                        <style>
                            .uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed {
                                fill: #FFA500; /* Use theme orange */
                            }
                        </style>
                    </defs>
                    <path class="uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed" d="M169.071,19.358c7.2.095,10.611-4.105,10.611-9,0-4.99-3.916-8.337-9.348-8.337h-2.116v30.695c0,2.558,1.674,3.411,3.158,3.411v.253h-10.358v-.253c1.516,0,3.158-.916,3.158-3.284V3.442c0-2.211-1.642-3.19-3.158-3.19v-.253h11.021c7.2,0,11.684,4.516,11.684,10.105,0,5.905-4.39,10.042-10.674,10.042-1.453,0-3.284-.253-3.979-.537v-.253Z"/>
                    <path class="uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed" d="M152.567,431.38v-.253c1.8,0,3.158-1.169,3.158-3.158v-29.559c0-1.989-1.358-3.158-3.158-3.158v-.253h21.664c.189,1.989.126,5.179.126,5.179h-.253c0-1.8-1.137-3.158-3.126-3.158h-11.211v15.506h10.232c1.453,0,1.895-.916,1.895-1.61h.253v4.579h-.253c0-.695-.442-1.611-1.895-1.611h-10.232v14.085c0,1.989,1.358,3.158,3.158,3.158v.253h-10.358Z"/>
                    <path class="uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed" d="M23.335,90.696c-4.232,0-7.548-1.453-8.747-2.211,0,0-1.737-5.905-1.99-7.2l.253-.063s3.411,7.453,10.516,7.453c3.79,0,6.821-2.716,6.821-6.821,0-8.811-15.506-8.084-15.506-19.958,0-4.926,4.137-8.211,8.842-8.211,2.905,0,5.558.947,7.295,1.737l1.863,5.811-.221.126c-1.105-1.8-4.2-5.653-9.126-5.653-3.79,0-5.905,2.59-5.905,5.621,0,8.179,15.758,7.926,15.758,19.011,0,7.295-5.621,10.358-9.853,10.358Z"/>
                    <path class="uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed" d="M309.335,90.696c-4.232,0-7.548-1.453-8.747-2.211,0,0-1.737-5.905-1.99-7.2l.253-.063s3.411,7.453,10.516,7.453c3.79,0,6.821-2.716,6.821-6.821,0-8.811-15.506-8.084-15.506-19.958,0-4.926,4.137-8.211,8.842-8.211,2.905,0,5.558.947,7.295,1.737l1.863,5.811-.221.126c-1.105-1.8-4.2-5.653-9.126-5.653-3.79,0-5.905,2.59-5.905,5.621,0,8.179,15.758,7.926,15.758,19.011,0,7.295-5.621,10.358-9.853,10.358Z"/>
                    <path class="uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed" d="M241.744,42.696l-14.468,14.468.804.804c4.823-4.823,11.655-4.421,16.075,0l29.739,29.739-100.471,100.471c-2.121,2.121-4.798,3.305-7.541,3.443-2.743-.138-5.42-1.322-7.541-3.443L57.871,87.707l29.739-29.739c4.422-4.422,11.253-4.823,16.075,0l.804-.804-14.468-14.468L0,132.717l14.468,14.468.804-.804c-4.823-4.823-4.421-11.655,0-16.075l29.739-29.739,100.471,100.471c4.421,4.421,4.823,11.253,0,16.075l.019.019h-.079v1.137c6.82,0,11.367,5.115,11.367,11.367v142.087h-42.058c-6.253,0-11.367-4.547-11.367-11.367h-1.137v20.461h127.31v-20.461h-1.137c0,6.82-5.115,11.367-11.367,11.367h-42.058v-142.087c0-6.252,4.547-11.367,11.367-11.367v-1.137h-.078l.019-.019c-4.823-4.823-4.421-11.655,0-16.075l100.471-100.471,29.74,29.739c4.421,4.422,4.823,11.253,0,16.075l.804.804,14.468-14.468-90.021-90.022Z"/>
                    <path class="uuid-43d619ca-4f85-4041-a9d2-15a0cc00c1ed" d="M202.739,91.695h-13.39c-2.945-7.443-9.344-13.134-17.217-15.114v-8.455c1.564-2.97,4.677-4.998,8.267-4.998v-7.265c-.426.059-.857.101-1.298.101-5.159,0-9.342-4.182-9.342-9.342h-7.576c0,5.159-4.182,9.342-9.342,9.342-.315,0-.627-.017-.934-.047v7.259c.307-.031.619-.047.934-.047,2.832,0,5.365,1.265,7.078,3.256v10.198c-7.873,1.98-14.271,7.671-17.217,15.114h-15.825c-.78,2.976-2.986,5.368-5.849,6.405v3.812c2.649.96,4.737,3.078,5.653,5.748l15.214.031c2.428,8.601,9.326,15.321,18.023,17.508v46.101h12.213v-46.101c8.708-2.19,15.611-8.924,18.031-17.539h12.771c.995-2.902,3.376-5.154,6.356-5.972v-3.363c-3.202-.879-5.709-3.413-6.552-6.629ZM159.92,120.821c-6.354-1.95-11.406-6.867-13.577-13.122l5.564.011c.321-.033.645-.051.975-.051,2.811,0,5.325,1.247,7.038,3.211v9.951ZM159.92,88.472c-1.713,1.991-4.246,3.256-7.078,3.256-.315,0-.627-.017-.934-.047v.014h-4.564c2.523-5.105,7.056-9.042,12.576-10.737v7.514ZM166.397,104.859c-2.894,0-5.241-2.346-5.241-5.241s2.346-5.241,5.241-5.241,5.241,2.346,5.241,5.241-2.346,5.241-5.241,5.241ZM172.133,80.958c5.521,1.695,10.054,5.633,12.577,10.737h-4.31v.033c-3.59,0-6.703-2.028-8.267-4.998v-5.772ZM172.133,120.821v-8.08c1.544-3.003,4.661-5.065,8.267-5.08v-.002h5.325c-2.163,6.274-7.224,11.207-13.592,13.162Z"/>
                </svg>
                <h1 class="text-3xl font-bold text-brand text-center font-heading">
                    Compound Visualizer
                </h1>
                <p class="text-center text-brand mt-2">
                    See how a balance can change over time in unpredictable ways.
                </p>
            </header>

            <!-- Inputs -->
            <div class="p-6 sm:p-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <!-- Starting Balance -->
                    <div>
                        <label for="startingBalance" class="block text-base font-medium text-brand font-heading">Starting Balance ($)</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <div class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center">
                                <span class="text-neutral-400 sm:text-sm">$</span>
                            </div>
                            <input type="number" id="startingBalance" value="8400" step="100" class="w-full pl-7 pr-4 py-2 bg-black border border-neutral-800 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-brand focus:border-brand">
                        </div>
                    </div>

                    <!-- Return per Block -->
                    <div>
                        <label for="returnPerBlock" class="block text-base font-medium text-brand font-heading">Return per Block (%)</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <input type="number" id="returnPerBlock" value="0.1379663161" step="0.01" class="w-full px-4 py-2 bg-black border border-neutral-800 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-brand focus:border-brand">
                            <div class="pointer-events-none absolute inset-y-0 right-0 pr-3 flex items-center">
                                <span class="text-neutral-400 sm:text-sm">%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Daily Blocks -->
                    <div>
                        <label for="dailyBlocks" class="block text-base font-medium text-brand font-heading">Daily Blocks</label>
                        <div class="mt-1">
                            <input type="number" id="dailyBlocks" value="6" step="1" class="w-full px-4 py-2 bg-black border border-neutral-800 text-white rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-brand focus:border-brand">
                        </div>
                    </div>

                    <!-- Chance of Loss -->
                    <div>
                        <label for="chanceOfLoss" class="block text-base font-medium text-brand font-heading">Chance of Loss (%)</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <input type="number" id="chanceOfLoss" value="5" step="0.1" class="w-full px-4 py-2 bg-black border border-neutral-800 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-black focus:ring-brand focus:border-brand">
                            <div class="pointer-events-none absolute inset-y-0 right-0 pr-3 flex items-center">
                                <span class="text-neutral-400 sm:text-sm">%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Duration Slider -->
                <div class="mt-8">
                    <label for="duration" class="block text-base font-medium text-brand font-heading">Duration (<span id="durationValue">365</span> Days)</label>
                    <input type="range" id="duration" min="30" max="730" value="365" class="w-full mt-2">
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 px-6 sm:p-8 pb-8">
                <div class="bg-black rounded-lg p-5 text-center border border-neutral-800">
                    <div class="text-sm font-medium text-brand font-heading">Expected APY</div>
                    <div id="apyDisplay" class="text-2xl font-bold text-brand">0.00%</div>
                </div>
                <div class="bg-black rounded-lg p-5 text-center border border-neutral-800">
                    <div class="text-sm font-medium text-brand font-heading">Final Balance</div>
                    <div id="finalBalance" class="text-2xl font-bold text-brand">$0.00</div>
                </div>
                <div class="bg-black rounded-lg p-5 text-center border border-neutral-800">
                    <div class="text-sm font-medium text-brand font-heading">Total Growth/Loss</div>
                    <div id="totalGrowth" class="text-2xl font-bold text-brand">$0.00</div>
                </div>
            </div>

            <!-- Chart -->
            <div class="p-6 sm:p-8 border-t border-neutral-800">
                <canvas id="growthChart"></canvas>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <footer class="container mx-auto max-w-7xl p-4 sm:p-8 text-xs text-brand font-heading">
        <p class="text-justify mb-4">
            DISCLAIMER: The accuracy and completeness of the content shared on this website cannot be guaranteed. This information is offered for informational purposes only and should not be considered financial or investment advice. No part of this website is intended to be a solicitation or recommendation for any security or crypto product. The Trisagion project is not a licensed securities dealer, broker, investment adviser, or investment bank.All users should conduct their own thorough research and consult with a qualified financial advisor before making any financial decisions. Engaging with cryptocurrencies involves significant risk, and you should be fully aware of the potential for loss. By using this website, you acknowledge that you are responsible for your own financial choices.
            <br><br>
            <span style="text-transform: uppercase;">The Trisagion project is an independent initiative and is not endorsed by, affiliated with, agents of or in a formalized relationship with the Holy See, the Peterâ€™s Pence Office, or the Secretariat for the Economy.Any third-party copyrighted materials including trademarks listed on this website are the property of their respective owners.</span>
        </p>
        <p class="text-center">
            &copy; MMXXV Trisagion. All Rights Reserved.
        </p>
    </footer>

    <script>
        // Get references to DOM elements
        const startingBalanceEl = document.getElementById('startingBalance');
        const returnPerBlockEl = document.getElementById('returnPerBlock');
        const dailyBlocksEl = document.getElementById('dailyBlocks');
        const chanceOfLossEl = document.getElementById('chanceOfLoss');
        const durationEl = document.getElementById('duration');
        const durationValueEl = document.getElementById('durationValue');
        
        const finalBalanceEl = document.getElementById('finalBalance');
        const totalGrowthEl = document.getElementById('totalGrowth');
        const apyDisplayEl = document.getElementById('apyDisplay');
        
        const ctx = document.getElementById('growthChart').getContext('2d');
        let growthChart = null; // To hold the chart instance

        // Helper: Format as currency
        const formatter = new Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD'
        });

        // Function to calculate *Expected* APY (always 365 days)
        function calculateAPY() {
            const blockReturnPercent = parseFloat(returnPerBlockEl.value) || 0;
            const dailyBlocks = parseFloat(dailyBlocksEl.value) || 0;
            const chanceOfLossPercent = parseFloat(chanceOfLossEl.value) || 0;
            
            const blockReturn = blockReturnPercent / 100;
            const chanceOfLoss = chanceOfLossPercent / 100;
            const chanceOfGain = 1 - chanceOfLoss;
            const lossMultiplier = 10;
            const lossReturn = blockReturn * lossMultiplier;

            // E(factor) = (chanceOfGain * (1 + blockReturn)) + (chanceOfLoss * (1 - lossReturn))
            const expectedBlockFactor = (chanceOfGain * (1 + blockReturn)) + (chanceOfLoss * (1 - lossReturn));

            // (Expected Block Factor) ^ dailyBlocks
            const dailyGrowthFactor = Math.pow(expectedBlockFactor, dailyBlocks);
            
            // APY = (1 + daily_rate)^365 - 1
            const apy = (Math.pow(dailyGrowthFactor, 365) - 1) * 100;
            
            apyDisplayEl.textContent = `${apy.toFixed(2)}%`;
        }

        // Function to calculate growth data for a specific duration
        function calculateGrowthData(duration) {
            // Get values from inputs
            const startBalance = parseFloat(startingBalanceEl.value) || 0;
            const blockReturnPercent = parseFloat(returnPerBlockEl.value) || 0;
            const dailyBlocks = parseFloat(dailyBlocksEl.value) || 0;
            const chanceOfLossPercent = parseFloat(chanceOfLossEl.value) || 0;

            // Convert percentage to decimal
            const blockReturn = blockReturnPercent / 100;
            const chanceOfLoss = chanceOfLossPercent / 100;
            const lossMultiplier = 10;

            const labels = [];
            const data = [];
            let currentBalance = startBalance;

            for (let day = 0; day <= duration; day++) {
                labels.push(`Day ${day}`);
                data.push(currentBalance.toFixed(2));
                
                // Simulate the next day's growth
                if (day < duration) {
                    let dailyBalance = currentBalance;
                    
                    // Simulate each block for the day
                    for (let block = 0; block < dailyBlocks; block++) {
                        if (Math.random() < chanceOfLoss) {
                            // It's a loss
                            dailyBalance *= (1 - (blockReturn * lossMultiplier));
                        } else {
                            // It's a gain
                            dailyBalance *= (1 + blockReturn);
                        }
                    }
                    currentBalance = dailyBalance;
                }
            }
            
            // Update summary cards for the selected duration
            const finalBalance = parseFloat(data[duration]);
            const totalGrowth = finalBalance - startBalance;

            finalBalanceEl.textContent = formatter.format(finalBalance);
            totalGrowthEl.textContent = formatter.format(totalGrowth);

            return { labels, data };
        }

        // Function to update or create the chart
        function updateChart() {
            const duration = parseInt(durationEl.value, 10);
            durationValueEl.textContent = duration; // Update slider value display

            const { labels, data } = calculateGrowthData(duration);
            
            // If chart already exists, destroy it before creating a new one
            if (growthChart) {
                growthChart.destroy();
            }
            
            const themeColor = '#FFA500'; // Brand color
            const gridColor = 'rgba(255, 165, 0, 0.1)'; // Brand color with alpha
            const textColor = '#FFA500'; // Brand color
            const headingFont = "'Times New Roman', Times, serif";
            const dataFont = "'Courier New', Courier, monospace";

            // Create the new chart
            growthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Compounded Balance ($)',
                        data: data,
                        borderColor: themeColor,
                        backgroundColor: 'rgba(255, 165, 0, 0.1)',
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0, // Hide points for a cleaner line
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: themeColor,
                        pointHoverBorderColor: '#fff',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#000000', // black
                            titleColor: textColor,
                            bodyColor: textColor,
                            borderColor: gridColor,
                            borderWidth: 1,
                            titleFont: { family: headingFont },
                            bodyFont: { family: dataFont },
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.y !== null) {
                                        label += formatter.format(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            display: false // Hide legend, as label is clear
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Days',
                                color: textColor,
                                font: { family: headingFont, size: 14 }
                            },
                            ticks: {
                                maxTicksLimit: 10,
                                autoSkip: true,
                                color: textColor,
                                font: { family: dataFont }
                            },
                            grid: {
                                color: gridColor,
                                drawOnChartArea: false, // Only show axis line
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Balance ($)',
                                color: textColor,
                                font: { family: headingFont, size: 14 }
                            },
                            ticks: {
                                // Format Y-axis labels as currency
                                callback: function(value, index, values) {
                                    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(value);
                                },
                                color: textColor,
                                font: { family: dataFont }
                            },
                            grid: {
                                color: gridColor,
                            }
                        }
                    }
                }
            });
        }

        // Add event listeners
        startingBalanceEl.addEventListener('input', updateChart);
        durationEl.addEventListener('input', updateChart);
        
        returnPerBlockEl.addEventListener('input', () => {
            calculateAPY();
            updateChart();
        });
        
        dailyBlocksEl.addEventListener('input', () => {
            calculateAPY();
            updateChart();
        });
        
        chanceOfLossEl.addEventListener('input', () => {
            calculateAPY();
            updateChart();
        });

        // Initial chart render and APY calculation on page load
        window.onload = () => {
            calculateAPY();
            updateChart();
        };
    </script>
</body>
</html>
