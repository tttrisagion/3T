# Application-wide configuration
database:
  host: mariadb
  user: root
  database: 3t

redis:
  host: redis
  port: 6379
  db: 0
  streams:
    balance_updates: "balance:updated"
    price_updates: "prices:updated"

celery:
  schedules:
    update_balance: 15.0
    schedule_market_data_fetching: 300.0 # Runs every 5 minutes to check for needed updates
    update_trading_range: 600.0
    providence_supervisor: 300.0
    providence_iteration_scheduler: 5.0
    purge_stale_runs: 900.0
    feed_supervisor: 15.0
    volatility_supervisor: 15.0

# Exchange configuration
exchanges:
  hyperliquid:
    # Optional proxy configuration for bypassing IP restrictions
    proxy:
        - "http://3tsgp01.trisagion.xyz:8080/"
        - "http://3tche01.trisagion.xyz:8080/"
        - "http://cors-proxy:8080/"
    origin: "https://trisagion.finance"
    # Polling configuration for non-websocket price updates
    poll_interval: 1.0  # seconds between price polls
    poll_batch_size: 10  # number of symbols to fetch per batch

# Exchange and product configuration can be managed here
# or dynamically from the database.
market_data:
  timeframes:
    - "1m"
    - "4h"
  concurrency_limit: 2
  lookback_bars:
    default: 20
    "4h": 50
    "1m": 20

# Reconciliation Engine Configuration
reconciliation_engine:
  # How often to run reconciliation checks (in seconds)
  rebalance_frequency: 600.0 # in seconds

  # Maximum margin allowed as percentage of total balance
  max_margin_usage_percentage: 0.026

  # Risk position size as a percentage of total balance
  risk_pos_percentage: 0.000005

  # Kelly Strategy Configuration
  kelly_threshold: 0.5  # maximum Kelly performance scaling threshold (ex: 0.5 = 50%)
  
  # Symbols to manage 
  # --- DISCLAIMER ---
  # The symbols listed are for informational purposes only.
  # This project is not financial, investment, or trading advice, nor is it a
  # solicitation or recommendation for any asset. The Trisagion project is not a
  # licensed financial entity.
  # All users must conduct their own research and consult a qualified financial
  # advisor before making decisions. Engaging with cryptocurrencies involves
  # significant risk, including the potential for total loss. By using this
  # configuration, you acknowledge full responsibility for your financial choices.
  # ---
  symbols:
    - "BTC/USDC:USDC"
    - "ETH/USDC:USDC"
    - "SOL/USDC:USDC"
    - "HYPE/USDC:USDC"
    - "BNB/USDC:USDC"
    - "XMR/USDC:USDC"
    - "ZEC/USDC:USDC"
    - "PAXG/USDC:USDC"

  # Observer nodes for consensus validation
  observer_nodes:
    - "http://3tsgp01.trisagion.xyz:8001/3T-observer.json"
    - "http://3tche01.trisagion.xyz:8001/3T-observer.json"
    - "http://exchange-observer:8001/3T-observer.json"
  
  # Order gateway URL for trade execution
  order_gateway_url: "http://order-gateway:8002"
  
  # Position staleness timeout in seconds (how old positions can be before ignored)
  position_staleness_timeout: 60
  
  # Minimum trade value in USD to execute orders (avoids dust trades)
  minimum_trade_threshold: 75.0
  
  # Order gateway request timeout in seconds
  order_timeout: 30

# Take Profit Configuration
take_profit:
  threshold: 0.1
  reward_multiple: 1

# Health Monitor Configuration (in seconds)
health_monitor:
  polling_interval: 0.5
  polling_threshold: 90.0

observability:
  # Sampling rate for noisy tasks. 1.0 = 100%, 0.001 = 0.1%
  sampling_rate: 0.00000001

providence:
  # Desired number of concurrent trading tasks to be managed by the supervisor
  desired_run_count: 100
  # Starting virtual balance for VOMS
  virtual_balance: 7000

  # ANN parameter search space - each range is [min, max] for random generation
  ann_params:
    max_duration: [300, 15778800]
    reversal_divisor: [1, 9]
    balance_divisor: 5
    pos_scaler: [1.618, 3.236]
    pos_scaler_divisor: 1000
    apr_target: [20, 100]
    apr_target_divisor: 1.618
    min_goal: [1, 9]
    max_goal: [1, 10]
    min_goal_weight: [1, 38]
    max_goal_weight: [69, 200]
    goal_weight_divisor: 10000
    entropy_window_minutes: [1, 15]
    entropy_window_samples: [5, 20]
    machine_vision_entropy_max: [5, 15]
    machine_vision_entropy_divisor: 100
    rolling_apr_minutes: [1, 30]
    max_cross_margin_ratio: 0.05
    pos_weight: 0.032732855219630354
    pos_weight_divisor: 3
  # Minutes before flat runs are eligible for purge (must be older than this AND flat)
  purge_age_minutes: 180
  # How often to persist run state to MySQL (in iterations, e.g., 50 = every 50 iterations)
  mysql_update_frequency: 50
  # Maximum absolute value for position direction (net trades)
  max_position_direction: 1024
  # Lower-leverage (more volatile) symbols get fewer runs proportionally
  max_margin_allocation_threshold: 45
